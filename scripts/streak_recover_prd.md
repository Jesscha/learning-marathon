# 스트릭(연속 출석) 복구 기능 PRD

## 1. 기능 개요
- 스트릭이 끊긴 다음날(복구 가능 기간)에, 모든 사용자가 "오늘" 다시 체크인하면 스트릭이 복구된다.
- 이 복구 체크인은 "어제"의 체크인과는 별개로, 오늘의 체크인만을 기준으로 한다.
- 복구 성공 시, 스트릭이 이전 값으로 복구되었음을 안내한다.

---

## 2. 상세 요구사항

### 2-1. 복구 기회 제공 조건
- 스트릭이 끊긴 다음날(스트릭이 0이 된 다음날)에만 복구 기회가 주어진다.
- 복구 기회는 자정(24:00)까지 유효하다.

### 2-2. 복구 방법
- 모든 사용자가 "오늘" 체크인을 다시 해야 한다(어제의 체크인과 무관).
- 오늘 체크인 데이터만을 기준으로 복구 여부를 판단한다.

### 2-3. 사용자 안내 및 UI/UX
- 사용자가 /today 명령어를 입력하면,
  - "오늘은 스트릭을 복구할 수 있는 날입니다. 모두 체크인하면 스트릭이 되살아납니다." 메시지를 보여준다.
  - 오늘의 체크인 현황을 보여준다(어제가 아님).
- 사용자가 /streak 명령어를 입력하면,
  - 복구 가능 기간일 경우: "오늘은 스트릭을 복구할 수 있는 날입니다." 메시지를 추가로 보여준다.
  - 그 외에는 기존 스트릭 현황만 보여준다.

### 2-4. 복구 성공/실패 처리
- 모든 사용자가 오늘 체크인을 완료하면, 스트릭이 복구된다.
- 복구 성공 시, 이전 스트릭 값으로 복구하고 +1을 추가한다 (복구 행위 자체도 하나의 스트릭 성공으로 간주).
- 복구 시, "streak이 N일로 다시 복구되었습니다." 메시지를 보여준다.
- 이를 위해, 스트릭이 끊기기 전의 streak 값을 StreakData에 저장해야 한다(예: previousStreak 필드 추가).
- 자정이 지나거나, 일부 사용자가 체크인을 하지 않으면 복구 기회는 사라진다.

### 2-5. 기타
- 복구 기능은 월, 수, 금(스트릭 계산일) 중 스트릭이 끊긴 경우에만 동작한다.
- 별도의 보안 확인, 관리자 로그 등은 필요하지 않다.

---

## 3. 데이터 구조 변경 제안

### StreakData (functions/src/types/StreakData.ts)
```ts
export interface StreakData {
  updatedAt: Timestamp;
  streak: {
    current: number;
    longest: number;
    previous?: number; // streak이 끊기기 전 값(복구용)
  };
}
```

---

## 4. 메시지 예시

- /today:
  ```
  오늘은 스트릭을 복구할 수 있는 날입니다. 모두 체크인하면 스트릭이 되살아납니다.
  (오늘의 체크인 현황)
  ```
- /streak (복구 가능 기간):
  ```
  오늘은 스트릭을 복구할 수 있는 날입니다.
  (현재 스트릭 현황)
  ```
- 복구 성공 시:
  ```
  streak이 N일로 다시 복구되었습니다.
  ```

---

## 5. 상태 플로우

- running: 스트릭 정상 유지 중
- missed: 스트릭이 끊긴 상태(복구 기회 없음)
- recovery_available: 스트릭이 끊겼으나 복구 기회가 남아있는 상태(다음날 자정까지)

---

## 6. 기타 참고 사항
- 복구 체크인은 기존 체크인과는 별개로 오늘의 체크인만을 기준으로 한다.
- 복구 성공 시, previousStreak 값을 current로 복구하고 +1을 추가한다 (복구도 스트릭 성공으로 간주).
- 복구 실패(자정까지 미완료) 시, streak는 0으로 유지된다. 